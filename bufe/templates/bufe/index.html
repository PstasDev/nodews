{% extends 'bufe/base.html' %}

{% block title %}B√ºf√© - NodeWS{% endblock %}
{% block meta_description %}B√ºf√© alkalmaz√°s - Rendel√©s lead√°sa{% endblock %}
{% block nav_home_active %}active{% endblock %}

{% block content %}
<!-- Rendk√≠v√ºli z√°rva Alert -->
{% if bufe and bufe.rendkivuli_zarva %}
<div class="card mb-lg" style="border: 3px solid #dc3545;">
    <div class="card-body text-center" style="background-color: #f8d7da;">
        <h1 style="color: #721c24; margin-bottom: 1rem;">üö´ A b√ºf√© rendk√≠v√ºli okok miatt z√°rva tart</h1>
        <p style="color: #721c24; font-size: 1.2rem; margin-bottom: 1.5rem;">
            Jelenleg nem fogadunk el rendel√©seket. K√©rj√ºk, n√©zzen vissza k√©s≈ëbb.
        </p>
        {% if user.is_authenticated %}
            {% load bufe_extras %}
            {% if user|is_bufeadmin %}
            <a href="{% url 'bufe:admin_dashboard' %}" class="btn btn-lg" style="background-color: #721c24; color: white;">
                üîß Admin fel√ºlet megnyit√°sa
            </a>
            {% endif %}
        {% endif %}
    </div>
</div>
{% else %}
<!-- Welcome Header -->
<div class="card mb-lg position-relative"></div>
    <!-- back to NodeWS button top left corner -->
    <a href="/" class="btn btn-link position-absolute" style="top: 1rem; left: 1rem; margin: 0;">
        ‚Üê NodeWS
    </a>
    <div class="card-body text-center">
        <h1>{{ welcome_message }}</h1>
        <p class="text-muted">{{ user_full_name }} ({{ user_domain }})</p>
    </div>
</div>

<!-- Status Alert -->
{% if bufe %}
<div class="alert {% if is_open %}alert-success{% else %}alert-warning{% endif %}">
    {% if is_open %}
    <span style="font-size: 1.5rem;">‚úÖ</span>
    <div>
        <strong>A b√ºf√© jelenleg nyitva van</strong>
        <br>
        <small>Rendel√©s√©t azonnal leadhatja √©s hamarosan √°tveheti.</small>
    </div>
    {% else %}
    <span style="font-size: 1.5rem;">‚ö†Ô∏è</span>
    <div>
        <strong>A b√ºf√© jelenleg z√°rva van</strong>
        <br>
        <small>Rendel√©s√©t akkor veheti √°t, amikor a b√ºf√© √∫jra kinyit.</small>
    </div>
    {% endif %}
</div>
{% endif %}

<!-- Quick Actions -->
<div class="card mb-lg">
    <div class="card-header">
        <h2 style="margin: 0;">Gyors m≈±veletek</h2>
    </div>
    <div class="card-body">
        <div class="grid grid-2">
            <div>
                <h4>üõí √öj rendel√©s</h4>
                <p class="text-muted">Rendeljen a b√ºf√© term√©keinkb≈ël egyszer≈±en √©s gyorsan.</p>
                <a href="{% url 'bufe:create_order' %}" class="btn btn-accent btn-lg w-full">Rendel√©s lead√°sa</a>
            </div>
            <div>
                <h4>üìã Rendel√©seim</h4>
                <p class="text-muted">Tekintse meg akt√≠v √©s kor√°bbi rendel√©seit.</p>
                <a href="{% url 'bufe:my_orders' %}" class="btn btn-outline btn-lg w-full">Rendel√©sek megtekint√©se</a>
            </div>
        </div>
    </div>
</div>

<!-- Recent Orders -->
{% if recent_orders %}
<div class="card">
    <div class="card-header">
        <div class="flex justify-between items-center">
            <h2 style="margin: 0;">Legut√≥bbi rendel√©sek</h2>
            <a href="{% url 'bufe:my_orders' %}" class="btn btn-sm btn-outline">√ñsszes megtekint√©se</a>
        </div>
    </div>
    <div class="card-body">
        {% for order in recent_orders %}
        <div class="order-card">
            <div class="order-card-header">
                <div>
                    <div class="order-id">#{{ order.id }}</div>
                    <div class="order-meta">
                        <span class="order-meta-item">
                            üïí {{ order.leadva|date:"Y.m.d H:i" }}
                        </span>
                    </div>
                </div>
                <span class="order-status {{ order.allapot }}">
                    {{ order.get_allapot_display }}
                </span>
            </div>
            
            <div class="order-total">
                <span>V√©g√∂sszeg:</span>
                <span style="color: var(--brand-accent);">{{ order.vegosszeg }} Ft</span>
            </div>
            
            <div class="order-actions">
                <a href="{% url 'bufe:order_detail' order.id %}" class="btn btn-sm btn-primary">R√©szletek</a>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% else %}
<div class="card">
    <div class="card-body text-center">
        <h3>M√©g nincs rendel√©se</h3>
        <p class="text-muted">Kezdje el most! Adja le els≈ë rendel√©s√©t a b√ºf√©b≈ël.</p>
        <a href="{% url 'bufe:create_order' %}" class="btn btn-accent">Els≈ë rendel√©s lead√°sa</a>
    </div>
</div>
{% endif %}
{% endif %}
{% endblock %}
