{% extends 'bufe/base.html' %}

{% block title %}Rendel√©seim - B√ºf√©{% endblock %}
{% block meta_description %}Rendel√©seim list√°ja{% endblock %}
{% block nav_orders_active %}active{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="card mb-lg">
    <div class="card-body">
        <div class="flex justify-between items-center" style="flex-wrap: wrap; gap: var(--space-md);">
            <div>
                <h1 style="margin-bottom: var(--space-xs);">üìã Rendel√©seim</h1>
                <p class="text-muted" style="margin: 0;">{{ user_full_name }} rendel√©sei</p>
            </div>
            <a href="{% url 'bufe:create_order' %}" class="btn btn-accent">+ √öj rendel√©s</a>
        </div>
    </div>
</div>

<!-- Messages -->
{% if messages %}
{% for message in messages %}
<div class="alert alert-{{ message.tags }}">
    {{ message }}
</div>
{% endfor %}
{% endif %}

<!-- Orders List -->
{% if orders %}
    {% for order in orders %}
    <div class="card mb-md">
        <div class="card-body">
            <div style="display: grid; grid-template-columns: 1fr auto; gap: var(--space-lg); align-items: start;">
                <!-- Order Info -->
                <div>
                    <div style="display: flex; align-items: center; gap: var(--space-md); margin-bottom: var(--space-sm);">
                        <h3 style="margin: 0;">Rendel√©s #{{ order.id }}</h3>
                        <span class="badge badge-{{ order.allapot }}">
                            {{ order.get_allapot_display }}
                        </span>
                    </div>
                    
                    <div class="order-meta" style="display: flex; flex-wrap: wrap; gap: var(--space-md); margin-bottom: var(--space-sm);">
                        <span class="order-meta-item">
                            üïí Leadva: {{ order.leadva|date:"Y.m.d H:i" }}
                        </span>
                        {% if order.idozitve %}
                        <span class="order-meta-item">
                            ‚è∞ Id≈ëz√≠tve: {{ order.idozitve|date:"Y.m.d H:i" }}
                        </span>
                        {% endif %}
                    </div>

                    {% if order.megjegyzes %}
                    <div style="margin-top: var(--space-sm); padding: var(--space-sm); background: var(--gray-50); border-radius: var(--radius-md);">
                        <small class="text-muted">üí¨ {{ order.megjegyzes|truncatewords:20 }}</small>
                    </div>
                    {% endif %}
                </div>

                <!-- Order Total & Actions -->
                <div style="text-align: right;">
                    <div style="margin-bottom: var(--space-md);">
                        <div class="text-muted" style="font-size: 0.875rem; margin-bottom: var(--space-xs);">V√©g√∂sszeg</div>
                        <div style="font-size: 1.75rem; font-weight: 700; color: var(--brand-accent);">
                            {{ order.vegosszeg }} Ft
                        </div>
                    </div>

                    <div style="display: flex; flex-direction: column; gap: var(--space-sm);">
                        <a href="{% url 'bufe:order_detail' order.id %}" class="btn btn-sm btn-primary">
                            R√©szletek ‚Üí
                        </a>
                        {% if order.allapot == 'leadva' %}
                        <form method="post" action="{% url 'bufe:cancel_order' order.id %}"
                              onsubmit="return confirm('Biztosan visszavonja a rendel√©st?');">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-sm btn-danger w-full">
                                Visszavon√°s
                            </button>
                        </form>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
{% else %}
<div class="card">
    <div class="card-body text-center">
        <div style="font-size: 4rem; margin-bottom: var(--space-md);">üì≠</div>
        <h3>M√©g nincs rendel√©se</h3>
        <p class="text-muted">M√©g nem adott le egyetlen rendel√©st sem. Kezdje el most!</p>
        <a href="{% url 'bufe:create_order' %}" class="btn btn-accent">Els≈ë rendel√©s lead√°sa</a>
    </div>
</div>
{% endif %}
{% endblock %}
